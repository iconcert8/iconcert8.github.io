<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/global.css">
    <title>iconcert8's log</title>
    <style>
      canvas:hover{
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="text-center">
      <h1 class="mx-4 mt-3">iconcert8's log</h1>
      <p style="font-size: small;">Sotfware Enginner</p>
      <a id="about" class="link py-2" href="/about/about.html">ğŸ§‘<strong>About</strong></a>
      <a id="study" class="link py-2" href="/study/study.html">âœï¸<strong>Study</strong></a>
      <a id="book" class="link py-2" href="/book/book.html">ğŸ“š<strong>Book</strong></a>
      <canvas class="mt-2" id="fishbowl" width="400" height="200"
      style="
        background-color: #44C3BC;
        border-radius: 20px;
        "></canvas>
    </div>
    <script>
      class Fish {
        constructor(ctx, x, y){
          this.ctx = ctx;
          this.x = x;
          this.y = y;
          this.w = 30;
          this.h = 20;
          this.images = [new Image(), new Image()];
          this.images[0].src = "./img/left-fish.png";
          this.images[1].src = "./img/right-fish.png";
          this.image = this.images[0];
          this.image.onload = ()=>{
            this.ctx.drawImage(this.images[0], this.x, this.y, this.w, this.h);
          };
        }

        move(x, y){
          if(this.x < x) this.image = this.images[1];
          else if(this.x > x) this.image = this.images[0];
          this.x = x;
          this.y = y;
          this.ctx.shadowOffsetX = 5;
          this.ctx.shadowOffsetY = 5;
          this.ctx.shadowColor = 'black';
          this.ctx.shadowBlur = 5;
          this.ctx.drawImage(this.image, this.x, this.y, this.w, this.h);
        }
      };

      class Feed{
        constructor(ctx, x, y, maxY){
          this.ctx = ctx;
          this.x = x;
          this.y = y;
          this.maxY = maxY;
          this.radius = 3;
          this.draw();
        }

        moveDown(){
          if(Math.abs(this.maxY - this.y) >= 1){
            this.y += 0.4;
          }
          this.draw();
        }

        draw(){
          this.ctx.beginPath();
          this.ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI);
          this.ctx.strokeStyle = "#FFFFFF";
          this.ctx.stroke();
        }
      }

      const canvas = document.getElementById("fishbowl");
      const ctx = canvas.getContext("2d");
      const fish = new Fish(ctx, 185, 90);
      const feed = new Feed(ctx, 100, 10, canvas.height-5);

      let targetFeeds = [feed];
      canvas.addEventListener(
        'click', 
        (event)=>{
          targetFeeds.push(
            new Feed(
              ctx, 
              event.pageX-canvas.offsetLeft, 
              event.pageY-canvas.offsetTop, 
              canvas.height-5)
            );
            
          
          targetFeeds.sort(
            (a, b)=>{
              adist = Math.sqrt(Math.pow(fish.x - a.x, 2) + Math.pow(fish.y - a.y, 2));
              bdist = Math.sqrt(Math.pow(fish.x - b.x, 2) + Math.pow(fish.y - b.y, 2));
              return adist - bdist;
            }
          );
        }, 
        false);
      
      let targetX = 185;
      let targetY = 90;
      setInterval(()=>{
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        if(targetFeeds.length != 0){
          targetX = targetFeeds[0].x;
          targetY = targetFeeds[0].y - 10;
        }

        if(
          (fish.x-2 <= targetX && (fish.x + 2 + fish.w) >= targetX)
        && (fish.y-2 <= targetY && (fish.y + 2 + fish.h) >= targetY)){
          fish.move(fish.x, fish.y);
          targetFeeds.shift();
          targetX = Math.floor(Math.random()*(canvas.width - fish.w));
          targetY = Math.floor(Math.random()*(canvas.height - fish.h));
        }else{
          let offsetX = targetX - fish.x;
          let offsetY = targetY - fish.y;
          let vector = Math.sqrt(offsetX*offsetX + offsetY*offsetY);
          let nextX = fish.x + offsetX/vector;
          let nextY = fish.y + offsetY/vector;
          fish.move(nextX, nextY);
        }

        targetFeeds.forEach(f=>f.moveDown());

        ctx.shadowOffsetX = 0;
        ctx.shadowOffsetY = 0;
        ctx.shadowBlur = 0;
        ctx.font = "8px Arial"; 
        ctx.fillStyle = "white";
        ctx.fillText("í´ë¦­í•˜ì—¬ ë¨¹ì´ë¥¼ ì¤˜ë³´ì„¸ìš”", 150, 16);
      }, 27);

    </script>
    <script>
      const about = document.getElementById("about");
      const aboutInitialHTML = about.innerHTML;
      registerMouseHoverEvent(about, aboutInitialHTML, 'ğŸ§‘<strong>', '</strong>', 'ì•ˆë…•í•˜ì„¸ìš”, ì €ëŠ”..')

      const study = document.getElementById("study");
      const studyInitialHTML = study.innerHTML;
      registerMouseHoverEvent(study, studyInitialHTML, 'âœï¸<strong>', '</strong>', 'í•™ìŠµí•˜ê³  ìˆì–´ìš”.')

      const book = document.getElementById("book");
      const bookInitialHTML = book.innerHTML;
      registerMouseHoverEvent(book, bookInitialHTML, 'ğŸ“š<strong>', '</strong>', 'ì½ê³  ìˆì–´ìš”.')

      function registerMouseHoverEvent(element, initialHTML, prefix, sufix, text){
        let intervalId = 0;
        element.onmouseenter = ()=>{
          if(intervalId != 0){
            return;
          }
          intervalId = writeIntervalText(element, prefix, sufix, text);
        }

        element.onmouseleave = ()=>{
          if(intervalId != 0){
            clearInterval(intervalId);
            intervalId = 0;
          }
          element.innerHTML = initialHTML;
        }
      }

      function writeIntervalText(element, prefix, sufix, text){
        const words = text.split('');
        let i = 0;
        let str = "";
        return setInterval(()=>{
          if(i >= words.length) return;
          str += words[i++];
          element.innerHTML = prefix + str + sufix;
        }, 170);
      }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
  </body>
</html>