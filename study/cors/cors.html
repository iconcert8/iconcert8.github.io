<!DOCTYPE html>
<html>
  <head>
    <script src="/study/study-template.js" type="text/javascript"></script>
    <meta id="contentInfo" title="🔒CORS란?" date="2023-02-09" />
    <title>CORS란?</title>
  </head>
  <body>
    <h2>SOP(Same Origin Policy)</h2>
    SOP란 <strong>브라우저</strong>에서 한 출처에서 로드한 문서/스크립트가 다른
    출처의 리소스와 상호작용하는 것을 막는 정책이다.
    <br />
    보안을 위한 정책으로 악성사이트에서 타 사이트에 악의적인 공격을 하는 것을
    막기 위함이다.
    <br /><br />
    그래서 생기는 문제도 있다. 다른 URL의 resource가 필요할 때 조차 막힌다는
    것이다.
    <br /><br />

    <h2>CORS(Cross Origin Resource Policy)</h2>
    CORS는 다른 URL의 resource가 필요할 때 접근을 허용하도록 하는 정책이다.
    <br /><br />
    CORS가 적용된 브라우저는 다른 URL에 대하여 다음과 같이 동작한다.
    <br /><br />
    <div class="px-2">
      <strong>1.</strong> 예비 요청(Preflight Request)을 보내어 서버에서
      인지하고 있는 메소드와 헤더인지 확인한다. 이는 혹시 모를 공격에 대비한
      요청인 것이다. <br /><br />
      <p class="ps-4">
        <strong>1-1.</strong> 예비 요청의 형식은 OPTIONS 메소드를 서버에 보내는
        것이다. 여기에는 Origin, Access-Control-Request-Methods,
        Access-Control-Request-Headers 가 포함되어 있다.
      </p>
      <strong>2.</strong> 서버는 어떤 요청을 허용하고 있는지 응답한다.
      Access-Control-Allow-Origin, Access-Control-Allow-Methods,
      Access-Control-Allow-Headers, Access-Control-Max-Age를 반환한다.
      <br /><br />
      <strong>3.</strong> 브라우저는 받은 응답에 보낸 요청을 비교하여 허용된
      요청이면 본 요청을 보낸다.
    </div>
    <br />
    예비요청을 안하고 바로 요청하는 경우도 있다.
    <strong>단순 요청(Simple Request)라고 한다.</strong> <br /><strong
      >다음을 모두 만족해야 한다.</strong
    >
    <br /><br />
    <div class="px-2">
      <strong>1.</strong> 요청 메소드는 GET, HEAD, POST 중 하나여야 한다.
      <br /><br />
      <strong>2.</strong> 헤더는 Accept, Accept-Language, Content-Language,
      Content-Type, DPR, Downlink, Save-Data, Viewport-Width, Width 이어야 한다.
      <br /><br />
      <strong>3.</strong> Content-Type 헤더가 application/x-www-form-urlencoded,
      mulipart/form-data, text/plain 중 하나여야 한다.
    </div>
    <br />
    <h2>Cross Origin 허용 방법</h2>
    요청을 허용하고자 하는 Origin, Method, Header에 대해서 처리가 필요하다.
    <br /><br />
    위에서 봤던 단순 요청(Simple Request)은 상관없지만
    <strong>예비 요청(Preflight Request)</strong>은 허용을 위한 처리가 필요하다.
    다음 2가지 방법이 있다. <br /><br />
    <div class="px-2">
      <strong>1.</strong> 서버의 응답헤더에 Access-Control-Allow-Origin을 직접
      설정해주는 방법이다. 허용하는 Origin, Method, Header를 응답에 추가해 주는
      것이다. 브라우저에서는 요청의 정보와 응답의 정보를 비교해 본 요청으로 넘어
      갈 수 있다. <br /><br />
      <strong>2.</strong> 프록시 서버를 두는 것이다. 서버간에는 SOP문제가 없다.
      이걸 이용해 동일 출처의 서버를 만들고 프록시로서 요청을 대신하도록 만드는
      것이다.
    </div>
  </body>
</html>
